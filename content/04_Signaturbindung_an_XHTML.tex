% vim: set tw=160:

\chapter{Bindung an ein XHTML-Dokument}
\label{chap:Signaturbindung}
Eine Signatur mit \gls{xml-dsig} hält ihre Verweise zu den signierten Inhalten über die \xmlelem{Reference}-Elemente aus \fref{sec:XML-DSig:Referenzen}.
Im Fall der Verwendung innerhalb eines \gls{webbrowser} muss das aufgerufene \gls{xhtml}-Dokument einen Verweis auf die Signatur beinhalten. Dies ist notwendig,
da die Information über die Bereiche, welche signiert wurden, nur in der Signatur selbst festgehalten werden. Ruft ein \gls{webbrowser} ein \gls{xhtml}-Dokument
ab, so muss ihm bekannt gemacht werden, dass für dieses Dokument Signaturinformationen vorhanden sind. Sind diese Informationen verfügbar gemacht worden, kann
der \gls{webbrowser} daraus die signierten Bereiche ermitteln.

Um solche Verweise auf Signaturen an ein \gls{xhtml}-Dokument binden zu können, bieten sich mehrere Verfahren an.

\section{HTTP-Header}
\index{HTTP-Header}
Als Antwort auf die Anfrage eines \gls{webbrowser} wird vom Webserver ein eigener \gls{http}-Header ausgeliefert, welcher eine Liste von \glspl{url} enthält, die auf
Signatur-Dateien verweisen. Dadurch wäre eine klare Trennung der Signaturen vom \gls{xhtml}-Inhalt gewährleistet.
Ein \gls{http}-Header kann auch mehrfach in der Antwort eines Webservers an einen \gls{webbrowser} enthalten sein. \gls{http} sieht keine Größenbeschränkung für
die Header-Informationen vor \cite{http:ietf}, jedoch sind Beschränkungen in \gls{http}-verarbeitenden Programmen möglich.

\lstinputlisting[caption={Verwendung von \protect\gls{http}-Header},
                 label=lst:http-header,
                 emph={X-Signature}]{source/http-header}

\section{\xmlelem{link}-Element}
Der \gls{xhtml}-Standard definiert das \xmlelem{link}-Element, um Relationen zu anderen Dokumenten zu definieren \cite{xhtml:oreilly}. Es ist Teil des
\xmlelem{head}-Bereichs und kann dort mehrfach eingesetzt werden. Ein einzelnes \xmlelem{link}-Element definiert genau eine Relation. Bezüglich des Verhaltens
der \gls{webbrowser} beim Verarbeiten eines \xmlelem{link}-Elements macht der \gls{xhtml}-Standard keine verbindlichen Aussagen. Es wird aber darauf
hingewiesen, dass dieses Element speziell für zukünftige, noch nicht definierte Verhaltensmuster bei \gls{webbrowser} vorgesehen ist.

Es ist damit möglich, über das \xmlattr{link}{href}-Attribut des \xmlelem{link}-Elements den Verweis auf die \gls{url} einer Signaturinformation zu realisieren. In
\fref{lst:link} ist dies auf \fref{lin:link-href} zu sehen. Da das
Element auch mehrfach in einem \gls{xhtml}-Dokument verwendet werden kann, lassen sich damit auch mehrere unterschiedliche Signaturinformationen einbinden.

\lstinputlisting[language=HTML,
                 caption={Verwendung von \xmlelem{link}},
                 label=lst:link,
                 emph={link,href}]{source/link.html}

\section{XML-Namespaces}
\label{sec:Signaturbindung:XML-NS}
Um mehrere verschiedene \gls{xml}-Dialekte in einem gemeinsamen Dokument zu trennen werden \gls{xml-ns} benutzt \cite{xml-ns:w3c}. Auch das Auffinden von
Elementen in einem Dokument, die zum selben \gls{xml}-Dialekt gehören, wird mittels \gls{xml-ns} bewerkstelligt \cite{xml:oreilly}. Diese Eigenschaften lässt
sich auf die beiden \gls{xml}-Dialekte \gls{xhtml} und \gls{xml-dsig} anwenden, um sie in einem Dokument zu kombinieren. Dazu kann die Signatur an einer
beliebigen Stelle innerhalb des \gls{xhtml}-Dokuments platziert werden und über \xmlelem{Reference} auf Bereiche des Dokuments verweisen. Zur Identifikation der
einzelnen Namespaces werden \glspl{uri} wie in \fref{tab:xml-namespaces} benutzt, welche in der Spezifikation der \gls{xml}-Dialekte festgelegt sind.

\fref{lst:xmlns} zeigt die Kombination der Namespaces von \gls{xhtml} und \gls{xml-dsig}. Dabei wird für das Wurzel-Element des Dokuments, \xmlelem{html} auf
\fref{lin:xmlns-html}, der Namespace auf den von \gls{xhtml} gesetzt und somit auf alle darunter gelegenen Elemente vererbt. Erst beim Signatur-Element,
\xmlelem{Signature} auf \fref{lin:xmlns-signature}, wird der Namespace auf den von \gls{xml-dsig} geändert, wobei nun wiederrum dieser Namespace auf die unter
der Deklaration gelegenen Elemente vererbt wird \cite{xml:oreilly}. Es ist auch möglich, einen Namespace auf ein Element explizit ohne Vererbung zuzuweisen, da
aber der Aufbau einer \gls{xml-dsig}-Signatur immer aus mehreren Elementen aus dem selben Namespace besteht, ist dies hier nicht praktikabel und soll nicht
näher erläutert werden.

\begin{table}
    \centering
    \begin{tabularx}{\textwidth}{ l X }
        \gls{xml}-Dialekt  & \gls{xml-ns} \\
        \hline
        \hline
        \gls{xhtml} & \url{http://www.w3.org/1999/xhtml} \\
        \hline
        \gls{xml-dsig} & \url{http://www.w3.org/2000/09/xmldsig\#} \\
        \hline
        \gls{xinclude} & \url{http://www.w3.org/2001/XInclude} \\
        \hline
        \gls{xslt} & \url{http://www.w3.org/1999/XSL/Transform} \\
        \hline
    \end{tabularx}
    \caption{Namespaces für unterschiedliche \protect\gls{xml}-Dialekte}
    \label{tab:xml-namespaces}
\end{table}

\lstinputlisting[language=HTML,
                 caption={Verwendung von XML-Namespaces},
                 label=lst:xmlns,
                 emph={Signature}]{source/xmlns.html}

Ein Nachteil der \gls{xml-ns} ergibt sich aus der selben Situation die auch schon in \fref{sec:XML-DSig:Transformationen:XSLT} geschildert wurde. Die
Transformationen der Signatur müssen sicherstellen, dass die Elemente der Signatur selbst nicht zu den signierten Informationen gehört.

\section{XInclude}
\label{sec:Signaturbindung:XInclude}
\gls{xinclude} ist eine neue Technologie, die vom W3C entwickelt wurde, um mehrere \gls{xml}-Dokumente in ein gemeinsames Dokument zusammenzuführen
\cite{xinclude:w3c}. Dabei wird das \xmlelem{include}-Element aus dem reservieren \gls{xml-ns} für \gls{xinclude} benutzt um über das
\xmlattr{xinclude}{href}-Attribut den \gls{uri} eines externen \gls{xml}-Dokuments während der Auswertung des Haupt-Dokuments einzubinden \cite{xml:oreilly}. Da
das Dokument nach dem Verarbeiten der \gls{xinclude}-Anweisungen wieder einen einzelnen \gls{xml}-Baum darstellt, ist es nötig wie in
\fref{sec:Signaturbindung:XML-NS} die Signatur mit ihrem eigenen \gls{xml-ns} von den \gls{xhtml}-Elementen abzugrenzen. Die Nachteile sind somit auch die
selben wie bei der direkten Einbindung der Signatur mittels \gls{xml-ns}.

\lstinputlisting[language=HTML,caption={Verwendung von XInclude},label=lst:xinclude,emph={include,xi}]{source/xinclude.html}


\section{Mikroformate}
Mikroformate sind auf Konvention beruhende, HTML-basierte Beschreibungen bestimmter Daten, zum Beispiel von Kontaktdaten. Mikroformate sind vor allem für
Webanwendungen wie etwa Suchmaschinen interessant, die aus den Mikroformaten datenfeldorientierte Informationen ziehen können \cite{mikroformate}.

Jede der zuvor vorgestellten Methoden macht es erforderlich zuerst das gesamte Dokument zu laden, um zu garantieren, dass alle Verweise aus den
\xmlelem{Reference}-Elementen auflösbar sind. Mit einem Mikroformat, das mit einer fest vorgegebenen \gls{xml-dsig}-Struktur arbeitet, könnten die verbleibenden
variablen Informationen aus der Struktur in eigene \gls{html}-Attribute eingebettet werden. Diese beiden Informationen, die nicht vorgegeben werden können sind
\xmlelem{KeyInfo} sowie \xmlelem{SignatureValue}. Um diese Attribute von \gls{xhtml} zu trennen müsste ein eigener \gls{xml-ns} geschaffen werden. Da ein
solches Mikroformat erst geschaffenwerden müsste, kann hier eine beliebige, global eindeutige \gls{uri} als Namespace benutzt werden.

Für den Rest der Informationen aus \gls{xml-dsig} wie \xmlelem{Reference} kann angenommen werden, dass es auf die Informationen innerhalb des
\gls{xhtml}-Elements verweist, in dem die Attribute des Mikroformats angehängt sind. Eine \xmlelem{Transformation} für \gls{c14n} und \gls{sha1} als
\xmlelem{DigestMethod} können gleichfalls vorgegeben werden. Dadurch kann, bereits während der \gls{webbrowser} das \gls{xhtml}-Dokument lädt, dynamisch eine
\gls{xml-dsig}-Struktur gebaut und auch ausgewertet werden. Dies hat den Vorteil, dass die Signaturen für Bereiche einer \gls{webseite} ausgewertet werden
können, bevor das gesamte \gls{xhtml}-Dokument vom \gls{webbrowser} geladen ist. Auch existiert so automatisch eine Zuordnung im \gls{webbrowser} zwischen
Signatur und signierten Elementen, ohne erst die \xmlelem{Reference}-Elemente auswerten zu müssen.

\lstinputlisting[language=HTML,
                 caption={Verwendung von Mikroformaten},
                 label=lst:mikroformat,
                 emph={signature,key,xml-dsig}]{source/mikroformate.html}

Ein Nachteil dieser Methode liegt darin, dass Teile der Flexibilität von \gls{xml-dsig} verloren gehen, da immer von vordefinierten \xmlelem{Reference}- und
\xmlelem{Transformation}-Elementen ausgegangen wird. Die Selektion von einzelnen Elementen je Signatur ist so nicht mehr möglich.

Eine zweite Variante von Mikroformaten ähnelt der in \fref{sec:Signaturbindung:XML-NS} beschriebenen Methode mit \gls{xml-ns}. Dabei wird ein externes
\gls{xml-dsig}-Dokument mit einem \gls{url} in einem Attribut aus einem eigenen \gls{xml-ns} referenziert. Dieses \gls{xml-dsig} bietet dann wieder die volle
Flexibilität, könnte aber so ausgelegt werden, dass nur Informationen selektiert und signiert werden können, die sich wie bei der ersten Variante unterhalb des
\gls{xhtml}-Elements mit dem entsprechenden Attribut befinden. Es wäre auch eine Kombination dieser beiden Varianten unter einem gemeinsamen Namespace
realisierbar.

